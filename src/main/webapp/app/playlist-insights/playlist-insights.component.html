<div class="playlist-insights root">
  <h1>Playlist Analyser</h1>

  <div class="container-fluid">
    <div class="row">
      <br />

      <div class="col-md-12">
        <form (ngSubmit)="sendLink()" [formGroup]="urlForm">
          <label class="form-label" for="name"> Playlist URL </label>

          <div class="searchBar">
            <input
              type="text"
              class="form-control"
              id="name"
              name="link-input"
              formControlName="name"
              placeholder="Paste the link to a public Spotify playlist here..."
              [(ngModel)]="linkInput"
              required
            />

            <button type="submit" id="submit-link" data-cy="entityCreateSaveButton" class="btn btn-primary" [disabled]="linkInput === ''">
              Go!
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <p class="lead" *ngIf="showWaitingMessage">Please wait while we process your playlist. This won't take too long.</p>
        <p class="lead" *ngIf="showErrorMessage">Sorry, we weren't able to process your playlist due to an error.</p>
      </div>
    </div>
  </div>

  <br />

  <div class="container-fluid px-5" *ngIf="pulledData">
    <h2>
      Viewing analysis for <b>{{ response?.playlistTitle }}</b>
    </h2>

    <p></p>

    <div class="row g-5 align-items-start">
      <div class="col-md-5">
        <div class="statBox">
          <h3>Valence</h3>
          <div class="progressBarOutside">
            <div
              class="progressBarInside"
              style="background: rgb(178, 55, 236, 1)"
              [ngStyle]="{
                'width.%': valenceValue
              }"
            ></div>
          </div>
          <h3>Energy</h3>
          <div class="progressBarOutside">
            <div
              class="progressBarInside"
              style="background: rgb(255, 178, 25, 1)"
              [ngStyle]="{
                'width.%': energyValue
              }"
            ></div>
          </div>
          <h3>Acousticness</h3>
          <div class="progressBarOutside">
            <div
              class="progressBarInside"
              style="background: rgb(75, 163, 195, 1)"
              [ngStyle]="{
                'width.%': acousticnessValue
              }"
            ></div>
          </div>
          <h3>Danceability</h3>
          <div class="progressBarOutside">
            <div
              class="progressBarInside"
              style="background: rgb(234, 0, 43, 1)"
              [ngStyle]="{
                'width.%': danceabilityValue
              }"
            ></div>
          </div>
        </div>

        <div class="statBox">
          <div class="songCard">
            <img [src]="response?.happiestSong?.songImageURL" [alt]="'Album artwork for ' + response?.happiestSong?.songTitle" />
            <p>This playlist's <b>happiest song</b> is {{ response?.happiestSong?.songTitle }}</p>
          </div>
          <div class="songCard">
            <img [src]="response?.energeticSong?.songImageURL" [alt]="'Album artwork for ' + response?.energeticSong?.songTitle" />
            <p>This playlist's <b>most energetic song</b> is {{ response?.energeticSong?.songTitle }}</p>
          </div>
          <div class="songCard">
            <img [src]="response?.sumsUpSong?.songImageURL" [alt]="'Album artwork for ' + response?.sumsUpSong?.songTitle" />
            <p>The <b>song that sums this playlist up</b> is {{ response?.sumsUpSong?.songTitle }}</p>
          </div>
          <div class="songCard">
            <img [src]="response?.anomalousSong?.songImageURL" [alt]="'Album artwork for ' + response?.anomalousSong?.songTitle" />
            <p>This playlist's <b>most anomalous song</b> {{ response?.anomalousSong?.songTitle }}</p>
          </div>
        </div>
      </div>

      <div class="col-md-7">
        <div class="row align-items-start">
          <div class="col-md-6">
            <h3>Top Playlist Artists</h3>
            <div #artistPieBox class="statBox">
              <ngx-charts-pie-chart
                [view]="[artistPieBox.offsetWidth, artistPieBox.offsetWidth * 0.9]"
                [results]="artistsPieChart"
                [legend]="false"
                [scheme]="pieSchemeA"
              >
              </ngx-charts-pie-chart>

              <table class="table table-striped table-dark">
                <thead>
                  <tr>
                    <th>Artist</th>
                    <th>Songs</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let artist of artistsPieChart | slice: 0:3; let i = index">
                    <td>{{ artist.name }}</td>
                    <td>{{ artist.value }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="col-md-6">
            <h3>Top Playlist Genres</h3>
            <div #genrePieBox class="statBox">
              <ngx-charts-pie-chart
                [view]="[genrePieBox.offsetWidth, genrePieBox.offsetWidth * 0.9]"
                [results]="genrePieChart"
                [legend]="false"
                [scheme]="pieSchemeA"
              >
              </ngx-charts-pie-chart>

              <table class="table table-striped table-dark">
                <thead>
                  <tr>
                    <th>Genre</th>
                    <th>Songs</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let genre of genrePieChart | slice: 0:3; let i = index">
                    <td>{{ genre.name }}</td>
                    <td>{{ genre.value }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div #timeChartBox class="statBox">
          <ngx-charts-bar-vertical
            [results]="timePeriodBar"
            [view]="[timeChartBox.offsetWidth, 300]"
            [showXAxisLabel]="true"
            [showYAxisLabel]="true"
            [rotateXAxisTicks]="true"
            [xAxis]="true"
            [yAxis]="true"
            [showGridLines]="false"
            [xAxisLabel]="'Decade'"
            [yAxisLabel]="'Number of Songs'"
            [scheme]="pieSchemeA"
          >
          </ngx-charts-bar-vertical>
        </div>
      </div>
    </div>
  </div>
</div>
